{"mappings":"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","sources":["src/js/cart.js"],"sourcesContent":["import axios from 'axios';\nimport '../../node_modules/modern-normalize/modern-normalize.css';\nimport './templates/footer-validation';\nimport './templates/footer-postApi';\n\n// CART VALUE\n\nconst spanCasa = document.querySelector('.css-span-casa');\nconst loaderEl = `<div class=\"loader\"></div>`;\n\nfunction onDocumentLoad() {\n  const obj = loadToLS('cartIds');\n  if (!Object.keys(obj).length) {\n    spanCasa.innerHTML = `CART(0)`;\n  } else {\n    spanCasa.innerHTML = `CART(${Object.keys(obj).length})`;\n  }\n}\n\n// Связываем элементы и переменные\nconst refs = {\n  cartHeading: document.querySelector('#cart-heading'),\n  productList: document.querySelector('#cart-product-list'),\n  warningContainer: document.querySelector('#warning-container'),\n  baseContainer: document.querySelector('#cart-base-container'),\n  closeButton: document.querySelector('.close-button'),\n  deleteAllBtn: document.querySelector('#button-wrapper'),\n  totalWrapper: document.querySelector('#total-wrapper'),\n};\n\n//достаём данные из local storage\n// const cartIdsData = localStorage.getItem('cartIds');\n// \nconst cartIdsArray = loadToLS('cartIds');\ngetCartProducts(cartIdsArray);\n\n//функция запроса данных\nfunction getCartProducts(cartIds) {\n  const BASE_URL = 'https://food-boutique.b.goit.study/api/products';\n  refs.productList.innerHTML = loaderEl;\n  refs.productList.classList.add('load-discount');\n  refs.totalWrapper.innerHTML = loaderEl;\n  refs.totalWrapper.classList.add('load-total');\n  Promise.all(\n    // *****\n    Object.keys(cartIds).map(productId => {\n      return axios\n        .get(`${BASE_URL}/${productId}`)\n        .then(response => {\n          if (!response.data) {\n            throw new Error(`Ошибка HTTP: ${response.status}`);\n          }\n          return response.data;\n        })\n        .catch(error => {\n          console.error('Ошибка при выполнении запроса:', error);\n          throw error;\n        });\n    })\n  )\n    .then(productsData => {\n      scrollAdding(productsData.length);\n      cartLargeNumber(productsData.length);\n      renderProductsCart(productsData);\n      countTotalPrice(productsData);\n      refs.productList.classList.remove('load-discount');\n    })\n    .catch(error => {\n      console.error('Ошибка при выполнении запросов:', error);\n    });\n}\n\n// Создаем шаблон элемента и выводим его на страницу\nfunction renderProductsCart(products) {\n  const markup = products\n    .map(el => {\n      const { category, img, name, price, size, _id } = el;\n\n      return `<li class=\"product-item\" data-productId=\"${_id}\">\n            <div class=\"product-img-wrapper\">\n              <img\n              class=\"product-item-img\"\n              src=\"${img}\"\n              alt=\"${name}\"\n              loading=\"lazy\"\n            />\n            </div>\n\n            <div class=\"product-item-content\">\n              <div class=\"characteristic-wrapper\">\n                <h3 class=\"product-item-heading product-bold\">${name}</h3>\n                <div class=\"charactetistic-text-container\">\n                  <span class=\"product-item-text\">\n                    <span class=\"key-span\">Category:</span>\n                    ${category}\n                  </span>\n                  <span class=\"product-item-text\">\n                    <span class=\"key-span\">Size:</span>\n                    ${size}\n                  </span>\n                </div>\n              </div>\n\n              <p class=\"product-price\">&#36;${price}</p>\n            </div>\n            <button type=\"button\" class=\"close-button product-bold\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"close-icon\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\">\n                    <path d=\"M11.0625 2.11488L9.88512 0.9375L6 4.82262L2.11488 0.9375L0.9375 2.11488L4.82262 6L0.9375 9.88512L2.11488 11.0625L6 7.17738L9.88512 11.0625L11.0625 9.88512L7.17738 6L11.0625 2.11488Z\" fill=\"#010101\"/>\n                </svg>\n              </button>\n\n            <div class=\"counter__wrapper\">\n              <button class=\"counter__btn\" type=\"button\" data-action=\"decrement\"> - </button>\n              <span class=\"counter__value\">1</span>\n              <button class=\"counter__btn\" type=\"button\" data-action=\"increment\"> + </button>\n            </div>\n\n          </li>`;\n    })\n    .join('');\n\n  return (refs.productList.innerHTML = markup);\n}\n\n// функция для вывода данных в счетчик в заголовке страницы\nfunction cartLargeNumber(cartLargeNumber) {\n  if (cartLargeNumber === 0) {\n    refs.warningContainer.classList.remove('visually-hidden');\n    refs.baseContainer.classList.add('visually-hidden');\n  }\n\n  refs.cartHeading.innerHTML = `CART (${cartLargeNumber})`;\n}\n\n// подсчет общей суммы\nfunction countTotalPrice(priceArray) {\n  let totalPrice = 0;\n\n  priceArray.forEach(product => {\n    return (totalPrice += product.price);\n  });\n\n  return (refs.totalWrapper.innerHTML = `\n        <span class=\"key-span\">Sum:</span>\n        <span class=\"price-text\">&#36;${totalPrice.toFixed(2)}</span>\n    `);\n}\n\n// функция для удаления одного элемента\nfunction clickDeleteElBtn(event) {\n  const btn = event.target.closest('.close-button');\n  if (!btn) {\n    return;\n  }\n  const element = btn.parentElement;\n  const productId = element.getAttribute('data-productid');\n\n  btn.parentElement.remove();\n\n  updateLocalStorage(productId);\n  const obj = loadToLS('cartIds');\n  spanCasa.innerHTML = `CART(${Object.keys(obj).length})`;\n}\n\n//Удаляем все элементы списка по нажатию на кнопку Delete All\nfunction clickDeleteAllBtn() {\n  refs.cartHeading.innerHTML = 'CART (0)';\n  refs.warningContainer.classList.remove('visually-hidden');\n  refs.baseContainer.innerHTML = '';\n  // ***\n  // localStorage.setItem('cartIds', JSON.stringify([]));\n  localStorage.setItem('cartIds', JSON.stringify({}));\n  const obj = loadToLS('cartIds');\n  console.log(Object.keys(obj).length);\n  spanCasa.innerHTML = `CART(${Object.keys(obj).length})`;\n}\n\n// дополнительная функция для обновления local storage после удаления элемента\nfunction updateLocalStorage(elementToRemove) {\n  // const cartIdsData = localStorage.getItem('cartIds');\n  // const cartIdsArray = JSON.parse(cartIdsData);\n  const cartIdsArray = loadToLS('cartIds');\n\n  delete cartIdsArray[elementToRemove];\n\n  // const updatedCartIds = Object.keys(cartIdsArray).filter(id => id !== elementToRemove);\n  // localStorage.setItem('cartIds', JSON.stringify(updatedCartIds));\n  saveToLS('cartIds', cartIdsArray);\n  cartLargeNumber(Object.keys(cartIdsArray).length);\n\n  getCartProducts(cartIdsArray);\n}\n\n// Добавляем скролл, когда 3 элемента и больше\nfunction scrollAdding(listLength) {\n  if (listLength > 3) {\n    refs.productList.classList.add('scroll-adding');\n  }\n}\n\n// Добавляем слушателей событий на список и на кнопку полного удаления\n\ndocument.addEventListener('DOMContentLoaded', onDocumentLoad);\nrefs.productList.addEventListener('click', clickDeleteElBtn);\nrefs.deleteAllBtn.addEventListener('click', clickDeleteAllBtn);\n\n// экспорт функций\nexport function saveToLS(key, value) {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch (error) {\n    console.log(error.message);\n  }\n}\nexport function loadToLS(key) {\n  try {\n    return JSON.parse(localStorage.getItem(key)) || {};\n  } catch (error) {\n    console.log(error.message);\n    return localStorage.getItem(key);\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n  |============================\n  | COUNTER\n  |============================\n*/\n\nrefs.productList.addEventListener('click', e => {\n  const target = e.target;\n\n  if (target.classList.contains('counter__btn')) {\n    const cartItem = target.closest('.product-item');\n    console.dir(cartItem);\n    const counterValue = cartItem.querySelector('.counter__value');\n    const counterAction = target.getAttribute('data-action');\n    const id = cartItem.dataset.productid;\n    console.log(id);\n    const localStorageItemParse = loadToLS('cartIds');\n    let counter = parseInt(counterValue.textContent);\n\n    if (counterAction === 'increment') {\n      counter += 1;\n    } else if (counterAction === 'decrement' && counter > 1) {\n      counter -= 1;\n    }\n\n    counterValue.textContent = counter;\n   \n    if (Object.keys(localStorageItemParse).includes(id)) {\n      console.log(localStorageItemParse);\n      localStorageItemParse[id] = counter;\n      console.log(localStorageItemParse);\n      saveToLS('cartIds', localStorageItemParse);\n      \n    }\n\n    recalculateTotalPrice();\n  }\n});\n\nfunction recalculateTotalPrice() {\n  const productsInCart = Array.from(refs.productList.querySelectorAll('.product-item'));\n\n  let totalPrice = 0;\n  let totalCartQuantity = 0;\n\n  productsInCart.forEach(productEl => {\n    const quantity = parseInt(productEl.querySelector('.counter__value').textContent);\n    const price = parseFloat(productEl.querySelector('.product-price').textContent.replace('$', ''));\n    totalPrice += price * quantity;\n\n    totalCartQuantity += quantity;\n    // spanCasa.textContent = `Cart(${totalCartQuantity})`;\n    // refs.cartHeading.innerHTML = `Cart(${totalCartQuantity})`;\n  });\n\n  refs.totalWrapper.innerHTML = `\n        <span class=\"key-span\">Sum:</span>\n        <span class=\"price-text\">&#36;${totalPrice.toFixed(2)}</span>\n    `;\n};\n\n\n\n\n\n\n"],"names":["$dIxxU","parcelRequire","$ce375e1befa17f1c$var$spanCasa","document","querySelector","$ce375e1befa17f1c$var$loaderEl","$ce375e1befa17f1c$var$refs","cartHeading","productList","warningContainer","baseContainer","closeButton","deleteAllBtn","totalWrapper","$ce375e1befa17f1c$var$getCartProducts","cartIds","innerHTML","classList","add","Promise","all","Object","keys","map","productId","default","get","then","response","data","Error","status","catch","error","console","productsData","length","$ce375e1befa17f1c$var$cartLargeNumber","products","markup","el","category","img","name","price","size","_id","join","$ce375e1befa17f1c$var$renderProductsCart","priceArray","totalPrice","forEach","product","toFixed","$ce375e1befa17f1c$var$countTotalPrice","remove","cartLargeNumber1","$ce375e1befa17f1c$export$53c15ea6e761c354","key","value","localStorage","setItem","JSON","stringify","log","message","$ce375e1befa17f1c$export$5b58afb9966d95d6","parse","getItem","addEventListener","obj","event","btn","target","closest","parentElement","getAttribute","elementToRemove","cartIdsArray1","$ce375e1befa17f1c$var$updateLocalStorage","e","contains","cartItem","dir","counterValue","counterAction","id","dataset","productid","localStorageItemParse","counter","parseInt","textContent","includes","productsInCart","Array","from","querySelectorAll","totalCartQuantity","productEl","quantity","parseFloat","replace","$ce375e1befa17f1c$var$recalculateTotalPrice"],"version":3,"file":"cart.4dfbcaab.js.map"}